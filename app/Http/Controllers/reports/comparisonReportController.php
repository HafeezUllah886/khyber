<?php
 namespace App\Http\Controllers\reports; use App\Http\Controllers\Controller; use App\Models\accounts; use App\Models\products; use App\Models\transactions; use Illuminate\Http\Request; use Illuminate\Support\Facades\DB; use SebastianBergmann\CodeCoverage\Report\Html\CustomCssFile; class comparisonReportController extends Controller { public function index() { $customers = accounts::customer()->get(); return view("\x72\145\x70\x6f\x72\x74\163\56\143\157\155\160\141\x72\x69\x73\x6f\x6e\56\151\156\144\145\x78", compact("\x63\165\x73\164\x6f\155\145\x72\x73")); } public function data($from1, $to1, $from2, $to2, $customer) { $products = products::orderBy("\143\141\164\x49\104")->get(); foreach ($products as $product) { $year1Sold = DB::table("\x73\141\154\145\x73")->join("\x73\x61\x6c\x65\x5f\x64\145\x74\x61\x69\154\163", "\163\x61\x6c\145\163\x2e\151\x64", "\x3d", "\x73\x61\x6c\x65\137\x64\x65\164\141\x69\x6c\163\56\163\141\154\x65\163\x49\104")->where("\x73\141\154\145\x73\x2e\x63\x75\x73\164\157\155\145\162\111\104", $customer)->where("\x73\x61\x6c\145\137\x64\145\164\x61\x69\x6c\163\56\160\x72\x6f\144\165\x63\164\x49\104", $product->id)->whereBetween("\163\141\x6c\145\x5f\144\145\x74\x61\x69\154\x73\x2e\144\x61\164\x65", array($from1, $to1))->sum("\163\x61\154\145\137\x64\145\164\x61\151\154\163\x2e\x71\164\x79"); $year2Sold = DB::table("\x73\141\x6c\x65\x73")->join("\163\x61\x6c\x65\x5f\144\x65\x74\141\x69\154\x73", "\163\141\154\x65\163\x2e\151\x64", "\x3d", "\163\141\x6c\145\x5f\x64\x65\164\x61\x69\x6c\x73\56\x73\141\x6c\145\163\x49\104")->where("\163\141\x6c\x65\x73\56\143\165\x73\164\157\155\x65\162\x49\104", $customer)->where("\x73\x61\154\145\137\x64\x65\164\141\151\x6c\x73\56\160\x72\x6f\x64\x75\143\164\x49\104", $product->id)->whereBetween("\163\x61\x6c\145\x5f\x64\145\x74\141\151\x6c\x73\56\x64\141\x74\145", array($from2, $to2))->sum("\x73\x61\154\145\x5f\144\145\164\x61\x69\154\x73\56\x71\x74\x79"); $product->sold1 = $year1Sold; $product->sold2 = $year2Sold; $growth = calculateGrowthPercentage($year1Sold, $year2Sold); $product->growth = $growth; } $customer = accounts::find($customer); return view("\x72\x65\x70\157\162\x74\163\56\143\157\x6d\x70\141\x72\x69\x73\x6f\156\x2e\x64\x65\164\x61\x69\x6c\x73", compact("\x66\x72\157\x6d\x31", "\x74\x6f\x31", "\146\162\157\155\62", "\164\x6f\62", "\143\165\163\x74\157\x6d\145\x72", "\x70\162\157\144\165\143\164\163")); } }